{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 判断传参是否为对象\nexport function isObject(data) {\n    return typeof data === 'object' && data !== null\n}\n\n// Object.defineProperty的特定简写 不可枚举\nexport function def(data, key, value) {\n    Object.defineProperty(data, key, {\n        enumerable: false,\n        configurable: false,\n        value\n    })\n}","// 重新数组的常用API\n// push shfit unshift pop reverse sort splice 会导致数组本身产生变化的API都要处理\n\n\nlet oldArrayPrototye = Array.prototype\n\nexport let arrayMethods = Object.create(oldArrayPrototye)\n\nconst methods = [\n    'push',\n    'shift',\n    'unshift',\n    'pop',\n    'reverse',\n    'sort',\n    'splice'\n]\n\nmethods.forEach(method => {\n    arrayMethods[method] = function (...args) {\n        const result = oldArrayPrototye[method].apply(this, args) // this指向value？？？\n        let ob = this.__ob__\n        // 不管删除类的API，只看添加或者修改数组的API\n        let inserted // 用户插入的元素\n        switch (method) {\n            case 'push':\n            case 'splice':\n                inserted = args\n                break;\n            case 'splice': // 删除 修改 新增 arr.splice(0,1, {name: 1})\n                inserted = args.slice(2)\n                break;\n            default:\n                break;\n        }\n        if (inserted) ob.observerArray(inserted) // 观察新插入的对象\n        return result\n    }\n})\n\n","import { isObject, def } from \"../util/index.js\"\nimport { arrayMethods } from './array.js'\n\n// 要承载比较多的方法\n// 当值是数组的时候，索引也会作为key去监听 get 0() get 1()这样是无意义的操作，也会拖慢性能\nclass Observer {\n    constructor(value) {\n        // 把new Observer(data)存放在每一个被监控的对象里 方便复写的数组API能调用观察者的方法\n        // value.__ob__ = this 这是错误的写法，因为定义的__ob__也是一个对象，会造成无限生成__ob__,并无限观察它。解决方法是\n        // Object.defineProperty 不可枚举 不可复写 已封装到def里\n        def(value, '__ob__', this)\n        if (Array.isArray(value)) {\n            // 直接操作数组API的方式，大多数都不是通过操作索引\n            // vm._data.testArr.push({ c: 1 }) 这种操作在没处理的结果是，新增的对象没添加观察，所以要改写数组的常用API，比如push、unshift、shift\n            // 如果数组里面有对象，才会对数组观察，否则是不必要浪费性能的\n            Object.setPrototypeOf(value, arrayMethods)\n            this.observerArray(value)\n        } else {\n            this.walk(value)\n        }\n    }\n    //为什么不在class里继续定义defineReactive 而是新开了一个functio  @question\n    //defineReactive(data) {}\n    walk(data) { // 递归 Object.defineProperty 添加get set\n        let keys = Object.keys(data)\n        keys.forEach(key => {\n            defineReactive(data, key, data[key])\n        })\n    }\n    observerArray(value) { // 观察数组\n        value.forEach(item => {\n            observe(item)\n        })\n    }\n\n\n}\n\nfunction defineReactive(data, key, value) {\n    observe(value)\n    Object.defineProperty(data, key, {\n        get() {\n            return value\n        },\n        set(newVal) {\n            if (newVal === value) { return }\n            // 如果用户手动设置更新了data的对象，那么也要给新对象上的数据进行数据劫持\n            observe(newVal)\n            value = newVal\n        }\n    })\n}\n\nexport function observe(data) {\n    // 如果不是对象的话，就可以直接退出了\n    if (!isObject(data)) {\n        return\n    }\n    return new Observer(data)\n}\n\n\n\n","import { observe } from './observer/index.js'\nexport function initState(vm) {\n    const opts = vm.$options\n\n    // vue文件的 script层 编写顺序 prop data computed watch 生命周期 method 针对传入实例的对应属性做不同的处理\n    if (opts.props) {\n        initProps(vm)\n    }\n    if (opts.methods) {\n        initMethod(vm)\n    }\n    if (opts.data) {\n        initData(vm)\n    }\n    if (opts.computed) {\n        initComputed(vm)\n    }\n    if (opts.watch) {\n        initWatch(vm)\n    }\n}\n\nfunction initProps() { }\nfunction initMethod() { }\nfunction initData(vm) {\n    // 数据初始化工作\n    let data = vm.$options.data\n    data = vm._data = typeof (data) === 'function' ? data.call(vm) : data\n\n    // MVVM 数据劫持 数据驱动视图更新 vue2.0是Object.defineProperty getter setter vue3 proxy\n    observe(data)\n\n}\nfunction initComputed() { }\nfunction initWatch() { }","// AST 虚拟dom\n\n// 需要的正则\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`        // abc-aaa\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`  // <aa:bb>\nconst startTagOpen = new RegExp(`^<${qnameCapture}`) // 标签开头的正则 <sss 捕获的内容是标签名\nconst startTagClose = /^\\s*(\\/?)>/                   // 匹配标签结束的 >  <div>   \nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`) // 匹配标签结尾的 </div>\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/   // 匹配属性 id=\"idName\"\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g         // {{ddd}} \n\n\n// 模板字符串：\n// <div id=\"app\">\n//  <p>{{name}}</p>\n// </div>\n\n//advance(***[0].length) 是regExp.match匹配返回第一个参数 \nfunction parserHTML(html) { // 解析HTMLDOM文本 => DOM树（包含属性、子节点、父节点）\n    function parsestartTag() { // 解析开始标签\n        let start = html.match(startTagOpen) // 匹配开始标签头\n        if (start) {\n            advance(start[0].length) // start[0]: <div  将标签从模板字符串中删除\n            const match = {\n                tagName: start[1], // 'div'\n                attrs: []\n            }\n            let end, attr;\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) { // 如果剩下的匹配不到结束标签，则视为有属性，处理属性值的返回\n                advance(attr[0].length) // 将开始标签的属性从模板字符串中删除\n                match.attrs.push({\n                    name: attr[1],\n                    value: attr[3] || attr[4] || attr[5]\n                })\n            }\n            if (end) {\n                advance(end[0].length) // 删除开始标签的>\n                return match // 这才是真正return到外面的结果\n            }\n        }\n    }\n    function advance(n) { // 前进n位 处理html解析的不断更新字符串\n        html = html.substring(n)\n    }\n\n    while (html) { // while 只要循环条件为真，一直执行的特点\n        let textEnd = html.indexOf('<')\n        if (textEnd === 0) { // 是标签的左边 包含开始标签 和结束标签\n            let startTagMatch = parsestartTag() // startTagMatch 包含tagName attrs\n            if (startTagMatch) {\n                console.log(startTagMatch);\n                continue // 开始标签匹配完毕后  继续下一次 匹配\n            }\n            let endTagMatch = html.match(endTag)\n            if (endTagMatch) {\n                advance(endTagMatch[0].length)\n                continue\n            }\n        }\n        let text\n        if (textEnd >= 0) { // 包含空白节点的情况\n            text = html.substring(0, textEnd)\n        }\n        if (text) {\n            advance(text.length)\n        }\n    }\n\n\n}\n\nexport function compileToFunction(template) {\n    let root = parserHTML(template)\n    return function render() {\n\n    }\n}","import { initState } from \"./state\"\nimport { compileToFunction } from './compiler/index'\n\nexport function initMixin(Vue) {\n    // vue 原型添加一个init方法\n    Vue.prototype._init = function (options) {\n        // 数据劫持\n        const vm = this\n        vm.$options = options // vue中的this.$options等于 用户传入的属性\n        initState(vm)         // 初始化状态\n\n        // 如果有el的参数，就渲染到节点上 template render\n        if (vm.$options.el) {\n            vm.$mount(vm.$options.el)\n        }\n\n\n    }\n    Vue.prototype.$mount = function (el) {\n        const vm = this\n        const options = vm.$options\n        el = document.querySelector(el)\n\n        // render > template > el 渲染优先级\n        if (!options.render) {\n            let template = options.template\n            if (!template && el) {\n                template = el.outerHTML\n            }\n\n            // template => render函数\n            const render = compileToFunction(template)\n            options.render = render\n        }\n\n    }\n}\n","import { initMixin } from './init'\nfunction Vue(options) {\n    // vue的初始化操作\n    this._init(options)\n}\ninitMixin(Vue)\n\nexport default Vue"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldArrayPrototye","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observerArray","Observer","isArray","setPrototypeOf","walk","keys","defineReactive","item","observe","get","set","newVal","initState","vm","opts","$options","props","initData","computed","watch","_data","call","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","attribute","parserHTML","html","parsestartTag","start","match","advance","length","tagName","attrs","end","attr","push","name","n","substring","textEnd","indexOf","startTagMatch","console","log","endTagMatch","text","compileToFunction","template","render","initMixin","Vue","_init","options","el","$mount","document","querySelector","outerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACO,SAASA,QAAT,CAAkBC,IAAlB,EAAwB;EAC3B,SAAO,QAAOA,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAA5C;EACH;;EAGM,SAASC,GAAT,CAAaD,IAAb,EAAmBE,GAAnB,EAAwBC,KAAxB,EAA+B;EAClCC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA4BE,GAA5B,EAAiC;EAC7BI,IAAAA,UAAU,EAAE,KADiB;EAE7BC,IAAAA,YAAY,EAAE,KAFe;EAG7BJ,IAAAA,KAAK,EAALA;EAH6B,GAAjC;EAKH;;ECZD;EACA;EAGA,IAAIK,gBAAgB,GAAGC,KAAK,CAACC,SAA7B;EAEO,IAAIC,YAAY,GAAGP,MAAM,CAACQ,MAAP,CAAcJ,gBAAd,CAAnB;EAEP,IAAMK,OAAO,GAAG,CACZ,MADY,EAEZ,OAFY,EAGZ,SAHY,EAIZ,KAJY,EAKZ,SALY,EAMZ,MANY,EAOZ,QAPY,CAAhB;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACtBJ,EAAAA,YAAY,CAACI,MAAD,CAAZ,GAAuB,YAAmB;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACtC,QAAMC,MAAM,GAAGT,gBAAgB,CAACO,MAAD,CAAhB,CAAyBG,KAAzB,CAA+B,IAA/B,EAAqCF,IAArC,CAAf,CADsC;;EAEtC,QAAIG,EAAE,GAAG,KAAKC,MAAd,CAFsC;;EAItC,QAAIC,QAAJ,CAJsC;;EAKtC,YAAQN,MAAR;EACI,WAAK,MAAL;EACA,WAAK,QAAL;EACIM,QAAAA,QAAQ,GAAGL,IAAX;EACA;;EACJ,WAAK,QAAL;EAAe;EACXK,QAAAA,QAAQ,GAAGL,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX;EACA;EAPR;;EAWA,QAAID,QAAJ,EAAcF,EAAE,CAACI,aAAH,CAAiBF,QAAjB,EAhBwB;;EAiBtC,WAAOJ,MAAP;EACH,GAlBD;EAmBH,CApBD;;ECdA;;MACMO;EACF,oBAAYrB,KAAZ,EAAmB;EAAA;;EACf;EACA;EACA;EACAF,IAAAA,GAAG,CAACE,KAAD,EAAQ,QAAR,EAAkB,IAAlB,CAAH;;EACA,QAAIM,KAAK,CAACgB,OAAN,CAActB,KAAd,CAAJ,EAA0B;EACtB;EACA;EACA;EACAC,MAAAA,MAAM,CAACsB,cAAP,CAAsBvB,KAAtB,EAA6BQ,YAA7B;EACA,WAAKY,aAAL,CAAmBpB,KAAnB;EACH,KAND,MAMO;EACH,WAAKwB,IAAL,CAAUxB,KAAV;EACH;EACJ;EAED;;;;;aACA,cAAKH,IAAL,EAAW;EAAE;EACT,UAAI4B,IAAI,GAAGxB,MAAM,CAACwB,IAAP,CAAY5B,IAAZ,CAAX;EACA4B,MAAAA,IAAI,CAACd,OAAL,CAAa,UAAAZ,GAAG,EAAI;EAChB2B,QAAAA,cAAc,CAAC7B,IAAD,EAAOE,GAAP,EAAYF,IAAI,CAACE,GAAD,CAAhB,CAAd;EACH,OAFD;EAGH;;;aACD,uBAAcC,KAAd,EAAqB;EAAE;EACnBA,MAAAA,KAAK,CAACW,OAAN,CAAc,UAAAgB,IAAI,EAAI;EAClBC,QAAAA,OAAO,CAACD,IAAD,CAAP;EACH,OAFD;EAGH;;;;;;EAKL,SAASD,cAAT,CAAwB7B,IAAxB,EAA8BE,GAA9B,EAAmCC,KAAnC,EAA0C;EACtC4B,EAAAA,OAAO,CAAC5B,KAAD,CAAP;EACAC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA4BE,GAA5B,EAAiC;EAC7B8B,IAAAA,GAD6B,iBACvB;EACF,aAAO7B,KAAP;EACH,KAH4B;EAI7B8B,IAAAA,GAJ6B,eAIzBC,MAJyB,EAIjB;EACR,UAAIA,MAAM,KAAK/B,KAAf,EAAsB;EAAE;EAAQ,OADxB;;;EAGR4B,MAAAA,OAAO,CAACG,MAAD,CAAP;EACA/B,MAAAA,KAAK,GAAG+B,MAAR;EACH;EAT4B,GAAjC;EAWH;;EAEM,SAASH,OAAT,CAAiB/B,IAAjB,EAAuB;EAC1B;EACA,MAAI,CAACD,QAAQ,CAACC,IAAD,CAAb,EAAqB;EACjB;EACH;;EACD,SAAO,IAAIwB,QAAJ,CAAaxB,IAAb,CAAP;EACH;;EC1DM,SAASmC,SAAT,CAAmBC,EAAnB,EAAuB;EAC1B,MAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAD0B;;EAI1B,MAAID,IAAI,CAACE,KAAT,EAAgB;;EAGhB,MAAIF,IAAI,CAACxB,OAAT,EAAkB;;EAGlB,MAAIwB,IAAI,CAACrC,IAAT,EAAe;EACXwC,IAAAA,QAAQ,CAACJ,EAAD,CAAR;EACH;;EACD,MAAIC,IAAI,CAACI,QAAT,EAAmB;;EAGnB,MAAIJ,IAAI,CAACK,KAAT,EAAgB;EAGnB;;EAID,SAASF,QAAT,CAAkBJ,EAAlB,EAAsB;EAClB;EACA,MAAIpC,IAAI,GAAGoC,EAAE,CAACE,QAAH,CAAYtC,IAAvB;EACAA,EAAAA,IAAI,GAAGoC,EAAE,CAACO,KAAH,GAAW,OAAQ3C,IAAR,KAAkB,UAAlB,GAA+BA,IAAI,CAAC4C,IAAL,CAAUR,EAAV,CAA/B,GAA+CpC,IAAjE,CAHkB;;EAMlB+B,EAAAA,OAAO,CAAC/B,IAAD,CAAP;EAEH;;EChCD;EAEA;EACA,IAAM6C,MAAM,iCAAZ;;EACA,IAAMC,YAAY,iBAAUD,MAAV,kBAAwBA,MAAxB,MAAlB;;EACA,IAAME,YAAY,GAAG,IAAIC,MAAJ,aAAgBF,YAAhB,EAArB;;EACA,IAAMG,aAAa,GAAG,YAAtB;;EACA,IAAMC,MAAM,GAAG,IAAIF,MAAJ,gBAAmBF,YAAnB,YAAf;;EACA,IAAMK,SAAS,GAAG,2EAAlB;EAIA;EACA;EACA;EACA;EAEA;;EACA,SAASC,UAAT,CAAoBC,IAApB,EAA0B;EAAE;EACxB,WAASC,aAAT,GAAyB;EAAE;EACvB,QAAIC,KAAK,GAAGF,IAAI,CAACG,KAAL,CAAWT,YAAX,CAAZ,CADqB;;EAErB,QAAIQ,KAAJ,EAAW;EACPE,MAAAA,OAAO,CAACF,KAAK,CAAC,CAAD,CAAL,CAASG,MAAV,CAAP,CADO;;EAEP,UAAMF,KAAK,GAAG;EACVG,QAAAA,OAAO,EAAEJ,KAAK,CAAC,CAAD,CADJ;EACS;EACnBK,QAAAA,KAAK,EAAE;EAFG,OAAd;EAIA,UAAIC,GAAJ,EAASC,IAAT;;EACA,aAAO,EAAED,GAAG,GAAGR,IAAI,CAACG,KAAL,CAAWP,aAAX,CAAR,MAAuCa,IAAI,GAAGT,IAAI,CAACG,KAAL,CAAWL,SAAX,CAA9C,CAAP,EAA6E;EAAE;EAC3EM,QAAAA,OAAO,CAACK,IAAI,CAAC,CAAD,CAAJ,CAAQJ,MAAT,CAAP,CADyE;;EAEzEF,QAAAA,KAAK,CAACI,KAAN,CAAYG,IAAZ,CAAiB;EACbC,UAAAA,IAAI,EAAEF,IAAI,CAAC,CAAD,CADG;EAEb3D,UAAAA,KAAK,EAAE2D,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAFpB,SAAjB;EAIH;;EACD,UAAID,GAAJ,EAAS;EACLJ,QAAAA,OAAO,CAACI,GAAG,CAAC,CAAD,CAAH,CAAOH,MAAR,CAAP,CADK;;EAEL,eAAOF,KAAP,CAFK;EAGR;EACJ;EACJ;;EACD,WAASC,OAAT,CAAiBQ,CAAjB,EAAoB;EAAE;EAClBZ,IAAAA,IAAI,GAAGA,IAAI,CAACa,SAAL,CAAeD,CAAf,CAAP;EACH;;EAED,SAAOZ,IAAP,EAAa;EAAE;EACX,QAAIc,OAAO,GAAGd,IAAI,CAACe,OAAL,CAAa,GAAb,CAAd;;EACA,QAAID,OAAO,KAAK,CAAhB,EAAmB;EAAE;EACjB,UAAIE,aAAa,GAAGf,aAAa,EAAjC,CADe;;EAEf,UAAIe,aAAJ,EAAmB;EACfC,QAAAA,OAAO,CAACC,GAAR,CAAYF,aAAZ;EACA,iBAFe;EAGlB;;EACD,UAAIG,WAAW,GAAGnB,IAAI,CAACG,KAAL,CAAWN,MAAX,CAAlB;;EACA,UAAIsB,WAAJ,EAAiB;EACbf,QAAAA,OAAO,CAACe,WAAW,CAAC,CAAD,CAAX,CAAed,MAAhB,CAAP;EACA;EACH;EACJ;;EACD,QAAIe,IAAI,SAAR;;EACA,QAAIN,OAAO,IAAI,CAAf,EAAkB;EAAE;EAChBM,MAAAA,IAAI,GAAGpB,IAAI,CAACa,SAAL,CAAe,CAAf,EAAkBC,OAAlB,CAAP;EACH;;EACD,QAAIM,IAAJ,EAAU;EACNhB,MAAAA,OAAO,CAACgB,IAAI,CAACf,MAAN,CAAP;EACH;EACJ;EAGJ;;EAEM,SAASgB,iBAAT,CAA2BC,QAA3B,EAAqC;EACxC,EAAWvB,UAAU,CAACuB,QAAD;EACrB,SAAO,SAASC,MAAT,GAAkB,EAAzB;EAGH;;ECzEM,SAASC,SAAT,CAAmBC,GAAnB,EAAwB;EAC3B;EACAA,EAAAA,GAAG,CAACpE,SAAJ,CAAcqE,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACrC;EACA,QAAM5C,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAc0C,OAAd,CAHqC;;EAIrC7C,IAAAA,SAAS,CAACC,EAAD,CAAT,CAJqC;EAMrC;;EACA,QAAIA,EAAE,CAACE,QAAH,CAAY2C,EAAhB,EAAoB;EAChB7C,MAAAA,EAAE,CAAC8C,MAAH,CAAU9C,EAAE,CAACE,QAAH,CAAY2C,EAAtB;EACH;EAGJ,GAZD;;EAaAH,EAAAA,GAAG,CAACpE,SAAJ,CAAcwE,MAAd,GAAuB,UAAUD,EAAV,EAAc;EACjC,QAAM7C,EAAE,GAAG,IAAX;EACA,QAAM4C,OAAO,GAAG5C,EAAE,CAACE,QAAnB;EACA2C,IAAAA,EAAE,GAAGE,QAAQ,CAACC,aAAT,CAAuBH,EAAvB,CAAL,CAHiC;;EAMjC,QAAI,CAACD,OAAO,CAACJ,MAAb,EAAqB;EACjB,UAAID,QAAQ,GAAGK,OAAO,CAACL,QAAvB;;EACA,UAAI,CAACA,QAAD,IAAaM,EAAjB,EAAqB;EACjBN,QAAAA,QAAQ,GAAGM,EAAE,CAACI,SAAd;EACH,OAJgB;;;EAOjB,UAAMT,MAAM,GAAGF,iBAAiB,CAACC,QAAD,CAAhC;EACAK,MAAAA,OAAO,CAACJ,MAAR,GAAiBA,MAAjB;EACH;EAEJ,GAjBD;EAkBH;;ECnCD,SAASE,GAAT,CAAaE,OAAb,EAAsB;EAClB;EACA,OAAKD,KAAL,CAAWC,OAAX;EACH;;EACDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}